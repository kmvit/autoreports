# Telegram-бот для отчетов о строительстве (construction_report_bot)

## Описание

Этот проект представляет собой Telegram-бота, разработанного для упрощения процесса создания, управления и обмена ежедневными отчетами о ходе строительных работ между подрядчиками (Администраторами) и заказчиками (Клиентами).

Бот позволяет администраторам управлять объектами, персоналом, техникой, а также формировать подробные утренние и вечерние отчеты, включающие состав ИТР, рабочих, использованную технику, фотоматериалы и комментарии. Заказчики могут просматривать и скачивать отчеты по своим объектам.

## Основные возможности

### Для Администратора (Подрядчика):
- Управление учетными записями заказчиков.
- Управление строительными объектами.
- Управление персоналом (ИТР и рабочие).
- Управление списком техники.
- Создание детализированных ежедневных отчетов (утро/вечер) с привязкой к объекту и типу работ.
- Добавление в отчеты: состава ИТР, рабочих, техники, фотоматериалов, комментариев.
- Просмотр и фильтрация истории отчетов.
- Редактирование существующих отчетов.
- Экспорт отчетов в форматы PDF и Excel.
- Направление готовых отчетов заказчикам через бот.

### Для Заказчика:
- Просмотр истории отчетов по доступным объектам.
- Фильтрация отчетов по дате, объекту, типу (утро/вечер).
- Просмотр отчета за текущий день.
- Скачивание отчетов в форматах PDF и Excel.

## Технологический стек

- **Язык программирования:** Python 3.x
- **Фреймворк для бота:** aiogram 3.x
- **Работа с базой данных:** SQLAlchemy 2.x, Alembic (для миграций)
- **Тип базы данных:** PostgreSQL (предпочтительно, через `asyncpg` или `psycopg2-binary`) или SQLite (`aiosqlite`)
- **Валидация данных:** Pydantic
- **Асинхронность:** asyncio

## Структура проекта

Проект имеет следующую основную структуру (внутри каталога `construction_report_bot`):

```
construction_report_bot/
├── app.py              # Точка входа приложения
├── requirements.txt    # Зависимости Python
├── .env                # Переменные окружения (требуется создать)
├── config/             # Конфигурация (настройки, клавиатуры)
├── database/           # Модули для работы с БД (модели, CRUD, сессия, миграции)
├── handlers/           # Обработчики сообщений и колбэков Telegram
├── middlewares/        # Middleware (аутентификация, проверка ролей)
├── services/           # Бизнес-логика (сервисы отчетов, экспорта, уведомлений)
├── states/             # Состояния FSM для диалогов
├── utils/              # Вспомогательные утилиты (логгирование, обработка ошибок)
└── tests/              # Тесты
```

## Установка и запуск

1.  **Клонируйте репозиторий:**
    ```bash
    git clone <repository_url>
    cd <repository_directory>
    ```
2.  **Создайте и активируйте виртуальное окружение:**
    ```bash
    python -m venv venv
    source venv/bin/activate  # Linux/macOS
    # venv\Scripts\activate  # Windows
    ```
3.  **Установите зависимости:**
    ```bash
    pip install -r construction_report_bot/requirements.txt
    ```
4.  **Настройте переменные окружения:**
    - Создайте файл `.env` в корневом каталоге проекта (рядом с `auth`, `steps`).
    - Скопируйте содержимое из `.env.example` (если он есть) или определите необходимые переменные (как минимум `BOT_TOKEN` и параметры подключения к БД). Пример:
      ```dotenv
      BOT_TOKEN=YOUR_TELEGRAM_BOT_TOKEN
      DB_USER=your_db_user
      DB_PASSWORD=your_db_password
      DB_HOST=localhost
      DB_PORT=5432
      DB_NAME=construction_reports_db
      ```
5.  **Примените миграции базы данных (если используется Alembic):**
    ```bash
    # Возможно, потребуется указать путь к alembic.ini
    alembic upgrade head
    ```
6.  **Запустите бота:**
    ```bash
    python construction_report_bot/app.py
    ```

## Дополнительная документация

- `auth`: Описание процесса аутентификации пользователей.
- `steps`: Детальное описание сценариев использования для разных ролей.
- `structure`: Планируемая структура каталогов и файлов проекта (может отличаться от реальной). 